package com.partner.busi.model;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;

import com.jfinal.plugin.activerecord.Page;
import com.jfinal.plugin.activerecord.Record;
import com.partner.busi.model.base.BaseMatchUser;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class MatchUser extends BaseMatchUser<MatchUser> {
	public static final MatchUser dao = new MatchUser();
	
	public List<MatchUser> findUserByMatchId(Map<String,Object> params){
		String sql = "select * from t_match_user where 1=1 ";
		List<Object> paraLst = new  ArrayList<Object>();
		if(StringUtils.isNotBlank(params.get("matchId").toString())){
			sql +=" AND MATCH_ID = ?  ";
			paraLst.add(params.get("matchId").toString());
		}
		if(StringUtils.isNotBlank(params.get("userId").toString())){
			sql +=" AND USER_ID = ? ";
			paraLst.add(params.get("userId").toString());
		}
		sql+=" ORDER BY CREATE_TIME ";
		return dao.find(sql,paraLst.toArray());
	};
	
	public void delMatchUser(int matchId, int userId){
		MatchUser user = dao.findFirst("select * from t_match_user where MATCH_ID = "+matchId+" AND USER_ID = "+userId);
		//user.set(attr, value);//修改状态，增加状态用来标记用户是否参加比赛
		dao.update();
	}
	
	public Page<MatchUser> findMatchUserListBySeq(int pageNum, int pagesize) {
		String select = "select m.ID, u.NAME ";
		StringBuilder sql = new StringBuilder(" from t_match_user m, t_user u where m.USER_ID = u.ID and m.SEQ IS NOT NULL");
		List<Object> params = new ArrayList<Object>();
		sql.append(" order by m.CREATE_TIME desc");
		return paginate(pageNum, pagesize, select, sql.toString(), params.toArray());
	}
	
	public Page<MatchUser> findMatchUserListNoSeq(int pageNum, int pagesize) {
		String select = "select m.ID, u.NAME ";
		StringBuilder sql = new StringBuilder(" from t_match_user m, t_user u where m.USER_ID = u.ID and m.SEQ IS NULL");
		List<Object> params = new ArrayList<Object>();
		sql.append(" order by m.CREATE_TIME desc");
		return paginate(pageNum, pagesize, select, sql.toString(), params.toArray());
	}
	
	public List<MatchUser> findUserByMatchId(int matchId){
		String sql = "select * from t_match_user where MATCH_ID = ? order by SEQ ";
		return dao.find(sql, matchId);
	};
	
	public void setNAME(String name) {
		set("NAME", name);
	}
	
	public String getNAME() {
		return get("NAME");
	}
	
}
